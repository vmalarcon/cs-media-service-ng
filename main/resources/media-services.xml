<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns="http://www.springframework.org/schema/beans"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd

                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <context:property-placeholder location="classpath:media-services.properties"/>
    <import resource="collector-rabbit.xml" />

    <bean id="filenamesRabbitTemplate" class="org.springframework.amqp.rabbit.core.RabbitTemplate">
        <property name="connectionFactory" ref="rabbitConnectionFactory"/>
        <property name="queue" value="${collector.queue}" />
        <property name="routingKey" value="${collector.queue}" />
    </bean>

    <!--can define multiple validator-->
    <bean id="mediaServiceProcess" class="com.expedia.content.media.processing.services.MediaServiceProcess">
        <constructor-arg>
            <list>
                <ref bean="expediaValidator"/>
                <ref bean="categoryValidator"/>
                <ref bean="providerRequiredValidator"/>
                <ref bean="fileUrlRequiredValidator"/>
                <ref bean="imageTypeRequiredValidator"/>
                <ref bean="mediaProviderValidator"/>
            </list>
        </constructor-arg>
        <constructor-arg ref="filenamesRabbitTemplate"/>
        <constructor-arg ref="lcmReporting"/>
        <constructor-arg ref="logActivityPicker"/>

        <property name="mediaStatusValidatorList">
            <list value-type="com.expedia.content.media.processing.services.validator.RequestMessageValidator">
                <ref bean="mediaStatusTypeValidator"/>
            </list>
        </property>
        <property name="activityWhiteList">
            <list>
                <ref bean="receptionActivity"/>
                <ref bean="derivativeCreationActivity"/>
                <ref bean="rejectActivity"/>
                <ref bean="publishActivity"/>
                <ref bean="dcpPickupActivity"/>
            </list>
        </property>
        <property name="processLogDao" ref="processLogDao">
        </property>
    </bean>

    <bean id="receptionActivity" class="com.expedia.content.media.processing.services.util.ActivityMapping">
        <!-- this will work -->
        <property name="activityType" value="Reception"/>
        <!-- this will *not* work -->
        <property name="statusMessage" value="RECEIVED"/>
        <property name="mediaType" value=".*"/>
    </bean>

    <bean id="derivativeCreationActivity" class="com.expedia.content.media.processing.services.util.ActivityMapping">
        <property name="activityType" value="DerivativeCreation"/>
        <property name="statusMessage" value="DERIVATIVES_CREATED"/>
        <property name="mediaType" value=".*"/>
    </bean>

    <bean id="rejectActivity" class="com.expedia.content.media.processing.services.util.ActivityMapping">
        <property name="activityType" value="Reject"/>
        <property name="statusMessage" value="REJECTED"/>
        <property name="mediaType" value=".*"/>
    </bean>

    <bean id="publishActivity" class="com.expedia.content.media.processing.services.util.ActivityMapping">
        <property name="activityType" value="Publish"/>
        <property name="statusMessage" value="PUBLISHED"/>
        <property name="mediaType" value=".*"/>
    </bean>

    <bean id="dcpPickupActivity" class="com.expedia.content.media.processing.services.util.ActivityMapping">
        <property name="activityType" value="DcpPickup"/>
        <property name="statusMessage" value="RECEIVED"/>
        <property name="mediaType" value="Cars"/>
    </bean>

    <bean id="expediaValidator" class="com.expedia.content.media.processing.services.validator.ExpediaIdValidator">
        <property name="fieldName" value="expediaId" />
    </bean>
    <bean id="providerRequiredValidator" class="com.expedia.content.media.processing.services.validator.RequiredValidator">
        <property name="fieldName" value="mediaProviderId" />
    </bean>
    <bean id="fileUrlRequiredValidator" class="com.expedia.content.media.processing.services.validator.RequiredValidator">
        <property name="fieldName" value="fileUrl" />
    </bean>
    <bean id="imageTypeRequiredValidator" class="com.expedia.content.media.processing.services.validator.RequiredValidator">
        <property name="fieldName" value="imageType" />
    </bean>
    <bean id="categoryValidator" class="com.expedia.content.media.processing.services.validator.NumericValidator">
        <property name="fieldName" value="categoryId" />
    </bean>
    <bean id="mediaProviderValidator" class="com.expedia.content.media.processing.services.validator.NumericValidator">
        <property name="fieldName" value="mediaProviderId" />
    </bean>

    <bean id="mediaStatusTypeValidator"
          class="com.expedia.content.media.processing.services.validator.MediaNamesValidator">
    </bean>

    <bean id="processLogDao" class="com.expedia.content.media.processing.services.dao.LcmProcessLogDao">
    </bean>

    <bean id="dataSource"
          class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="net.sourceforge.jtds.jdbc.Driver" />
        <property name="url" value="${datasource.url}" />
        <property name="username" value="${datasource.username}" />
        <property name="password" value="${datasource.password}" />
    </bean>

    <bean id="lodgingLogActivityProcess" class="com.expedia.content.media.processing.pipleline.reporting.LodgingLogActivityProcess">
        <constructor-arg value="${log.thread.pool.size}" />
        <constructor-arg type="boolean" value="false"/>
    </bean>

    <bean id="carsLogActivityProcess" class="com.expedia.content.media.processing.pipleline.reporting.CarsLogActivityProcess">
        <constructor-arg value="${log.thread.pool.size}" />
    </bean>

    <bean id="logActivityPicker" class="com.expedia.content.media.processing.domain.ImageTypeComponentPicker">
        <constructor-arg name="imageTypeComponentMap">
            <map>
                <entry key="VirtualTour" value-ref="lodgingLogActivityProcess" />
                <entry key="Lodging" value-ref="lodgingLogActivityProcess" />
                <entry key="Cars" value-ref="carsLogActivityProcess" />
            </map>
        </constructor-arg>
    </bean>

</beans>
